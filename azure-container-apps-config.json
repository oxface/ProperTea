# Azure Container Apps Service Discovery Configuration
# This file shows how services will discover each other in Azure Container Apps

# Environment Variables for Service Discovery
# These will be automatically set by Azure Container Apps when services are deployed

# For Landlord BFF:
# - gateway: Will resolve to the Gateway container app
# - workflow-orchestrator: Will resolve to the WorkflowOrchestrator container app

# For Gateway (YARP):
# - organization-api: Will resolve to the Organization API container app  
# - identity-api: Will resolve to the Identity API container app
# - user-management-api: Will resolve to the UserManagement API container app
# - workflow-orchestrator: Will resolve to the WorkflowOrchestrator container app

# For WorkflowOrchestrator:
# - organization-api: Will resolve to the Organization API container app
# - identity-api: Will resolve to the Identity API container app  
# - user-management-api: Will resolve to the UserManagement API container app

# Azure Container Apps automatically provides service discovery through:
# 1. Internal DNS resolution using service names
# 2. Environment variables with service endpoints
# 3. Dapr service invocation (if using Dapr)

# Example deployment configuration for Azure Container Apps:
{
  "containerApps": {
    "gateway": {
      "name": "gateway",
      "environmentVariables": [],
      "ingress": {
        "external": true,
        "targetPort": 8080
      }
    },
    "landlord-bff": {
      "name": "landlord-bff", 
      "environmentVariables": [],
      "ingress": {
        "external": true,
        "targetPort": 8080
      }
    },
    "organization-api": {
      "name": "organization-api",
      "environmentVariables": [
        {
          "name": "ConnectionStrings__CosmosDb",
          "secretRef": "cosmos-connection-string"
        }
      ],
      "ingress": {
        "external": false,
        "targetPort": 8080
      }
    },
    "identity-api": {
      "name": "identity-api",
      "environmentVariables": [
        {
          "name": "ConnectionStrings__CosmosDb", 
          "secretRef": "cosmos-connection-string"
        }
      ],
      "ingress": {
        "external": false,
        "targetPort": 8080
      }
    },
    "user-management-api": {
      "name": "user-management-api",
      "environmentVariables": [
        {
          "name": "ConnectionStrings__CosmosDb",
          "secretRef": "cosmos-connection-string"
        }
      ],
      "ingress": {
        "external": false,
        "targetPort": 8080
      }
    },
    "workflow-orchestrator": {
      "name": "workflow-orchestrator",
      "environmentVariables": [
        {
          "name": "AzureWebJobsStorage",
          "secretRef": "storage-connection-string"
        }
      ],
      "ingress": {
        "external": false,
        "targetPort": 80
      }
    }
  }
}
